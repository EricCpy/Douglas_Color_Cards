---
title: "Douglas color cards"
author: "Nicolas Hahn, Eric Jonas, Pavlo Kravets, Simon Schäfer"
date: "2024-06-05"
output: bookdown::gitbook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("code/setup.R")
```

# Douglas color cards

The Douglas color cards are used to determine someones skin color to find the most appropriate cosmetics products - e.g. the perfect foundation. They show 64 squares of various colors. The center four squares get punched out.

```{r colorcard, echo=FALSE, warning=FALSE}
display_color_card(master_colors, "Crow", "Ccol", "Lab", 2)
```

The color cards are placed in front of ones facial skin and a photo is taken. The visual information about the skin color (visible at the four center squares) and the reference color squares is evaluated by an app and the closest skin color type is calculated.

While production 42 color cards are printed on each single sheet. On each color card is a QR code that is used by the app to determine where on a sheet the color card was printed.

## Quality assurance

To assure the best skin color typification it is crucial to assure a consistent production of the color cards. Especially the reference color squares colors variance should be as low as possible.

The existence of QR codes indicating the position on a sheet reduces the requirements to meet because thus only the variance of reference color squares at the same position of the sheets have to be as low as possible. Differnces between reference color squares among different positions on a sheet can be taken care of in the app once the positional information is evaluated from the QR code.

## Data description

The data given consists of two files. One file holds the master color information given in the Lab colorspace as well as in the CMYKS color space. In the latter S stands for special and might be some kind of skin color pigment.

The second file holds color information obtained from 13 printed sheets. Thus we find the Lab color information for all 64 squares for 42 color cards for 13 sheets resulting in `r format(64*42*13*3, scientific=FALSE)` numeric values.

## Objectives

* Analyse where variance or difference in color is noteworthy high / low
* Visualize variance and differences in colors
* Use the CMYKS color information to match the Lab color values

## Color spaces

Lab, CMYK, rgb, CMYKS?

## Color difference

One can analyse difference in color in at least three ways:

1. Qualitative: Looking at them - but this takes a while if thee are many colors
1. Quantitative: Compare the numeric values of each color space dimension
1. Quantitative: Compare all color space dimensions at once with a proper function (i. e. \( \Delta \) E)

### Comparing color space dimensions one by one

blub

### Compaing colors with distance function

A function to compare two colors given in Lab color space is \( \Delta \) E - also called dE in this report. Actually there are multiple versions of [Delta E](https://zschuessler.github.io/DeltaE/learn/). The first was given 1976 and just calculates the Euklidean distance in the Lab color space:

\[\Delta E_{ab}=\sqrt{(L_2-L_1)^2+(a_2-a_1)^2+(b_2-b_1)^2}\]

In this report we use the most recent \( \Delta \) E formula from 2000. It is much more complex but solves problems when calculating color difference for colors with high lightness value.

The aim of dE is that the calculated distance value can be interpreted in a meaningful way for humans. The following table can be a taken as a guide but there exceptions are possible.

| Delta E   |	Perception                                |
|-----------|-------------------------------------------|
| <= 1.0    | Not perceptible by human eyes.            |
| 1 - 2     | Perceptible through close observation.    |
| 2 - 10    | Perceptible at a glance.                  |
| 11 - 49   | Colors are more similar than opposite     |
| 100       |	Colors are exact opposite                 |

Comparing the first color cards colors with the master colors shows that there is one color that is pretty far from the master color (row 3, column 2)

```{r dE_colorcard, echo=FALSE}
color_differences %>% 
  filter(Sheet == 1, Row == 1, Column == 1) %>% 
  ggplot() +
  geom_tile(aes(fill = Difference, x = Ccol, y = Crow)) +
  geom_point(aes(x = Ccol+0.25, y = Crow, color = Color), size = 8) +
  scale_color_identity() +
  geom_point(
    data = master_colors %>% rowwise() %>% mutate(Color = lab_to_rgb(L, a, b)),
    aes(x = Ccol-0.25, y = Crow, color = Color), size = 8
    ) +
  coord_fixed()
```

## Questions

1. Is the color difference greater within a sheet (among positions) or across sheets?  (Simon Schäfer)
1. Is there a difference in dE regarding skin or non skin color?  (Simon Schäfer)
1. How is the color special used (regression)?  (Simon Schäfer)
1. What dE value can be seen on our screen? (Simon Schäfer)
1. Color difference of mean over all cards to master target: is it in some uncertainty area? (Eric Jonas)
1. Are some Lab values more often in master than in mean? (Eric Jonas)
1. How close are CMYK and Lab value in rgb? (Eric Jonas)
1. Is there a correlation between dE(CMYK colors, Lab colors) and S? (Eric Jonas)
1. Are there colors that are very far off the master target? <- Field 18 (Why; see Lab values)
1. Are findings on L, a or b also there in dE? (On the subjective meaning)?
1. Can colors on cards be differntiated visually?
